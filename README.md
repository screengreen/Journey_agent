# Journey Agent

Telegram Ð±Ð¾Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð¸ÑÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ (ÐºÐ¾Ð½Ñ†ÐµÑ€Ñ‚Ñ‹, Ð²Ñ‹ÑÑ‚Ð°Ð²ÐºÐ¸ Ð¸ Ñ‚.Ð´.) Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ ÑÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¸ Ð³ÐµÐ¾Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸.

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑÐ¾ÑÑ‚Ð¾Ð¸Ñ‚ Ð¸Ð· ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ñ… ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²:

- **Telegram Bot** (`src/bot/`) - Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- **Parsers** (`src/parsers/`) - Ð¿Ð°Ñ€ÑÐµÑ€Ñ‹ Ð´Ð»Ñ Telegram ÐºÐ°Ð½Ð°Ð»Ð¾Ð² Ð¸ Ð²ÐµÐ±-ÑÐ°Ð¹Ñ‚Ð¾Ð² Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÐ¼Ð¸
- **Services** (`src/services/`) - ÑÐµÑ€Ð²Ð¸ÑÑ‹ Ð´Ð»Ñ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ°, Ð³ÐµÐ¾Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹
- **Storage** (`src/storage/`) - Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ð¾Ð¹ Ð‘Ð” Ð¸ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- **Models** (`src/models/`) - Ð¼Ð¾Ð´ÐµÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…

ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ ÑÐ¼. [ARCHITECTURE.md](ARCHITECTURE.md)

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

### 1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

```bash
pip install -r requirements.txt
```

### 2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ `.env.example` Ð² `.env` Ð¸ Ð·Ð°Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ:

```bash
cp .env.example .env
```

ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ:
- `TELEGRAM_BOT_TOKEN` - Ñ‚Ð¾ÐºÐµÐ½ Telegram Ð±Ð¾Ñ‚Ð° (Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñƒ [@BotFather](https://t.me/BotFather))

### 3. Ð—Ð°Ð¿ÑƒÑÐº Weaviate

1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Docker Ð¸ Docker Compose (Ð²ÐµÑ€ÑÐ¸Ñ Ð¿Ð»Ð°Ð³Ð¸Ð½Ð° `docker compose` 2.x Ð¸Ð»Ð¸ Ð²Ñ‹ÑˆÐµ).
2. ÐŸÐ¾Ð´Ð½Ð¸Ð¼Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸Ñ:

   ```bash
   docker compose up -d
   ```

3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ Ð±Ð°Ð·Ñ‹: Ð¾Ñ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ `http://localhost:8080/v1/.well-known/ready` â€” ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ `{"status":"READY"}`.

`docker-compose.yml` Ñ€Ð°Ð·Ð²Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð´Ð²Ð° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°:

- `contextionary` â€” Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸ `text2vec-contextionary`, Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‰Ð¸Ð¹ Ð²Ð½ÐµÑˆÐ½Ð¸Ñ… API ÐºÐ»ÑŽÑ‡ÐµÐ¹;
- `weaviate` â€” ÑÐ°Ð¼Ð° Ð²ÐµÐºÑ‚Ð¾Ñ€Ð½Ð°Ñ Ð‘Ð” Ñ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼ (Ð°Ð½Ð¾Ð½Ð¸Ð¼Ð½Ñ‹Ð¼) Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸ÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² volume `weaviate-data`.

ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÐºÐ»Ð°ÑÑ‚ÐµÑ€ Ð¼Ð¾Ð¶Ð½Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ `docker compose down`, Ð° ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÐ¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ â€” `docker compose down -v`.

## Ð—Ð°Ð¼ÐµÐ½Ð° contextionary Ð½Ð° ÑÐ²Ð¾Ð¹ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ‚Ð¾Ñ€

`contextionary` â€” ÑÑ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ð±ÑƒÑ‡ÐµÐ½Ð½Ð°Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒ ÑÐ¼Ð±ÐµÐ´Ð´Ð¸Ð½Ð³Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Weaviate Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð² Ð¼Ð¾Ð´ÑƒÐ»Ðµ `text2vec-contextionary`. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÐµÑ‘ Ð½Ð° ÑÐ²Ð¾Ð¹ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, OpenAI, Hugging Face Ð¸Ð»Ð¸ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ ÑÐµÑ€Ð²Ð¸Ñ). ÐžÐ±Ñ‰Ð¸Ð¹ Ð¿Ð¾Ñ€ÑÐ´Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹:

1. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸:
   - `text2vec-openai` â€” Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ API OpenAI/compatible;
   - `text2vec-transformers` â€” Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ðº self-hosted inference (Docker-Ð¾Ð±Ñ€Ð°Ð· `semitechnologies/transformers-inference` Ð¸Ð»Ð¸ Ð»ÑŽÐ±Ð¾Ð¹ HTTP ÑÐµÑ€Ð²Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ñ‚ÐµÐºÑÑ‚ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð²ÐµÐºÑ‚Ð¾Ñ€);
   - Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ Ð¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ñ‹ Ð² [Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸ Weaviate](https://weaviate.io/developers/weaviate/modules/retrieval).
2. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `docker-compose.yml`:
   - ÑƒÐ´Ð°Ð»Ð¸Ñ‚Ðµ Ð±Ð»Ð¾Ðº `contextionary` (ÐµÑÐ»Ð¸ Ð¾Ð½ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½) Ð¸Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐ²Ð¾Ð¹ ÑÐµÑ€Ð²Ð¸Ñ Ñ Ð¼Ð¾Ð´ÐµÐ»ÑŒÑŽ;
   - Ð² ÑÐµÑ€Ð²Ð¸ÑÐµ `weaviate` Ð¿Ð¾Ð¼ÐµÐ½ÑÐ¹Ñ‚Ðµ `ENABLE_MODULES` Ð¸ `DEFAULT_VECTORIZER_MODULE` Ð½Ð° Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ñ‹Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ;
   - Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ, Ñ‚Ñ€ÐµÐ±ÑƒÐµÐ¼Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `OPENAI_APIKEY` Ð¸Ð»Ð¸ `TRANSFORMERS_INFERENCE_API`).
3. ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹: `docker compose down && docker compose up -d`.
4. ÐŸÑ€Ð¸ ÑÐ¼ÐµÐ½Ðµ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ‚Ð¾Ñ€Ð° Ð·Ð°Ð½Ð¾Ð²Ð¾ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ð±Ñ‹Ð»Ð¸ Ð¿ÐµÑ€ÐµÐ¸Ð½Ð´ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð½Ð¾Ð²Ñ‹Ð¼Ð¸ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð°Ð¼Ð¸.

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ð³Ð¾ Hugging Face-Ð¸Ð½Ñ„ÐµÑ€ÐµÐ½ÑÐ°

```yaml
services:
  embeddings:
    image: semitechnologies/transformers-inference:sentence-transformers-multilingual-e5-large
    restart: unless-stopped
    environment:
      ENABLE_CUDA: "0"        # Ð²ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ 1, ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ GPU
    expose:
      - "8080"

  weaviate:
    environment:
      ENABLE_MODULES: text2vec-transformers
      DEFAULT_VECTORIZER_MODULE: text2vec-transformers
      TRANSFORMERS_INFERENCE_API: http://embeddings:8080
```

### ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ OpenAI/ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾Ð³Ð¾ API

```yaml
  weaviate:
    environment:
      ENABLE_MODULES: text2vec-openai
      DEFAULT_VECTORIZER_MODULE: text2vec-openai
      OPENAI_APIKEY: ${OPENAI_APIKEY}
      OPENAI_APIKEY_PATH: ""   # ÐµÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ´Ð°Ñ‘Ñ‚Ðµ ÐºÐ»ÑŽÑ‡ Ñ‡ÐµÑ€ÐµÐ· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ
```

Ð”Ð»Ñ VLLM/ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… HTTP-ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð°: Ð³Ð»Ð°Ð²Ð½Ð¾Ðµ â€” ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ. ÐŸÐ¾ÑÐ»Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ‚Ð¾Ñ€Ð° ÐºÐ¾Ð´ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¾ÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð¿Ñ€ÐµÐ¶Ð½Ð¸Ð¼, Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ð¾Ð¼ÐµÐ½ÑÑ‚ÑŒ `vectorizer_config` Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ Ð½Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ `wvc.config.Configure.Vectorizer.text2vec_openai()`.

## Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ smoke-Ñ‚ÐµÑÑ‚Ð°

Ð’ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ ÐµÑÑ‚ÑŒ `scripts/test_weaviate.py`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:

- Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚ÑŒ ÑÐµÑ€Ð²ÐµÑ€Ð° Weaviate;
- Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ;
- Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹ Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ `near_text`.

Ð—Ð°Ð¿ÑƒÑÐº:

```bash
pip install "weaviate-client>=4.6,<5" requests
python scripts/test_weaviate.py
```

ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ:

- `WEAVIATE_URL` â€” Ð°Ð´Ñ€ÐµÑ ÑÐµÑ€Ð²ÐµÑ€Ð° (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ `http://localhost:8080`);
- `WEAVIATE_TEST_COLLECTION` â€” Ð¸Ð¼Ñ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸;
- `DROP_COLLECTION_AFTER_TEST` â€” ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð² `0`, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ Ð¿Ð¾ÑÐ»Ðµ Ñ‚ÐµÑÑ‚Ð°.

## Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð‘Ð” Ñ‡ÐµÑ€ÐµÐ· Pythonâ€‘ÐºÐ»Ð¸ÐµÐ½Ñ‚

1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚:

   ```bash
   pip install "weaviate-client>=4.6,<5"
   ```

2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð½Ð¸Ð¶Ðµ (ÐµÐ³Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð² Ñ„Ð°Ð¹Ð» `examples/weaviate_demo.py` Ð¸ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ `python examples/weaviate_demo.py`):

```python
import weaviate
import weaviate.classes as wvc

client = weaviate.Client("http://localhost:8080")
collection_name = "Journeys"

# Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ, ÐµÑÐ»Ð¸ Ð¾Ð½Ð° ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚
if collection_name in client.collections.list_all():
    client.collections.delete(collection_name)

# 1. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ (ÑÑ…ÐµÐ¼Ñ‹)
client.collections.create(
    name=collection_name,
    description="ÐŸÑƒÑ‚ÐµÐ²Ñ‹Ðµ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸ Ð¸ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸",
    properties=[
        wvc.config.Property(
            name="title",
            description="ÐšÐ¾Ñ€Ð¾Ñ‚ÐºÐ¾Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ¸",
            data_type=wvc.config.DataType.TEXT,
        ),
        wvc.config.Property(
            name="description",
            description="Ð Ð°Ð·Ð²Ñ‘Ñ€Ð½ÑƒÑ‚Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°",
            data_type=wvc.config.DataType.TEXT,
        ),
        wvc.config.Property(
            name="country",
            description="Ð¡Ñ‚Ñ€Ð°Ð½Ð°, Ðº ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ Ð·Ð°Ð¼ÐµÑ‚ÐºÐ°",
            data_type=wvc.config.DataType.TEXT,
        ),
    ],
    vectorizer_config=wvc.config.Configure.Vectorizer.text2vec_contextionary(),
)

collection = client.collections.get(collection_name)

# 2. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð±ÑŠÐµÐºÑ‚Ð¾Ð² (batch ÑƒÑÐºÐ¾Ñ€ÑÐµÑ‚ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ)
journeys = [
    {
        "title": "Ð¡Ñ‘Ñ€Ñ„-ÐºÑÐ¼Ð¿ Ð½Ð° Ð‘Ð°Ð»Ð¸",
        "description": "Ð£ÑŽÑ‚Ð½Ð°Ñ Ð´ÐµÑ€ÐµÐ²Ð½Ñ Ð§Ð°Ð½Ð³Ñƒ, ÑƒÑ€Ð¾ÐºÐ¸ ÑÐµÑ€Ñ„Ð¸Ð½Ð³Ð° Ð¸ ÐºÐ¾Ð²Ð¾Ñ€ÐºÐ¸Ð½Ð³Ð¸ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð¾ÐºÐµÐ°Ð½Ð¾Ð¼.",
        "country": "Indonesia",
    },
    {
        "title": "ÐŸÐµÑˆÐ¸Ð¹ Ñ‚ÑƒÑ€ Ð² Ð”Ð¾Ð»Ð¾Ð¼Ð¸Ñ‚Ð°Ñ…",
        "description": "ÐœÐ°Ñ€ÑˆÑ€ÑƒÑ‚ Ð¿Ð¾ Ñ…Ñ€ÐµÐ±Ñ‚Ñƒ Ð¢Ñ€Ðµ-Ð§Ð¸Ð¼Ðµ Ñ Ð½Ð¾Ñ‡Ñ‘Ð²ÐºÐ°Ð¼Ð¸ Ð² rifugio Ð¸ Ñ€Ð°ÑÑÐ²ÐµÑ‚Ð°Ð¼Ð¸ Ð² Ð³Ð¾Ñ€Ð°Ñ….",
        "country": "Italy",
    },
    {
        "title": "Ð—Ð¸Ð¼Ð½Ð¸Ð¹ Ð¡Ð°Ð¿Ð¿Ð¾Ñ€Ð¾",
        "description": "Ð¤ÐµÑÑ‚Ð¸Ð²Ð°Ð»ÑŒ ÑÐ½ÐµÐ¶Ð½Ñ‹Ñ… ÑÐºÑƒÐ»ÑŒÐ¿Ñ‚ÑƒÑ€ Ð¸ Ð¿Ð¾ÐµÐ·Ð´ÐºÐ¸ Ð½Ð° Ð³Ð¾Ñ€ÑÑ‡Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð¥Ð¾ÐºÐºÐ°Ð¹Ð´Ð¾.",
        "country": "Japan",
    },
]

with collection.batch.dynamic() as batch:
    for journey in journeys:
        batch.add_object(properties=journey)

# 3. ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð¿Ð¾Ñ…Ð¾Ð¶ÐµÑÑ‚Ð¸ Ñ‚ÐµÐºÑÑ‚Ð°
result = collection.query.near_text(
    query="Ñ‚Ñ‘Ð¿Ð»Ñ‹Ð¹ Ð¾ÐºÐµÐ°Ð½, ÑÑ‘Ñ€Ñ„ Ð¸ ÐºÐ¾Ð²Ð¾Ñ€ÐºÐ¸Ð½Ð³",
    limit=2,
    return_metadata=wvc.query.MetadataQuery(distance=True),
)

for obj in result.objects:
    print(f"{obj.properties['title']} ({obj.properties['country']}) â€” distance={obj.metadata.distance:.3f}")

client.close()
```

Ð’ Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ðµ Ð¿Ð¾ÐºÐ°Ð·Ð°Ð½Ñ‹ Ñ‚Ñ€Ð¸ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ðµ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸:

- ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸Ð¸ (ÑÑ…ÐµÐ¼Ñ‹) Ñ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¼Ð¸ Ð¿Ð¾Ð»ÑÐ¼Ð¸;
- Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ Ð±Ð°Ñ‚Ñ‡ÐµÐ¼;
- ÑÐµÐ¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð¾Ð¸ÑÐº `near_text`, Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÑŽÑ‰Ð¸Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚Ñ‹, Ð±Ð»Ð¸Ð·ÐºÐ¸Ðµ Ðº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¼Ñƒ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ.

ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ñ‹Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð¼ Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾Ð²Ñ‹Ðµ, Ð³ÐµÐ¾- Ð¸ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¼ÐµÐ´Ð¸Ð¹Ð½Ñ‹Ðµ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð° Ð¸Ð»Ð¸ ÐºÐ¾Ð¼Ð±Ð¸Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ `near_vector`, Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¸ ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ¸ â€” ÑÐ¼. Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ Weaviate Ð´Ð»Ñ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ñ… ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÐµÐ².

## Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

### Ð—Ð°Ð¿ÑƒÑÐº Telegram Ð±Ð¾Ñ‚Ð°

```bash
python scripts/run_bot.py
```

Ð‘Ð¾Ñ‚ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹.

### Ð—Ð°Ð¿ÑƒÑÐº Ð¿Ð°Ñ€ÑÐµÑ€Ð¾Ð²

```bash
python scripts/run_parser.py
```

ÐŸÐ°Ñ€ÑÐµÑ€Ñ‹ Ð±ÑƒÐ´ÑƒÑ‚ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¸Ð· Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… ÐºÐ°Ð½Ð°Ð»Ð¾Ð² Ð¸ ÑÐ°Ð¹Ñ‚Ð¾Ð².

### Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

ÐŸÐµÑ€ÐµÐ´ Ð¿ÐµÑ€Ð²Ñ‹Ð¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÐ¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ¾Ð»Ð»ÐµÐºÑ†Ð¸ÑŽ Ð² Weaviate:

```bash
python scripts/add_events.py
```

## Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð±Ð¾Ñ‚Ð°

1. **Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°Ð½Ð°Ð»Ð¾Ð²**: ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð±Ð¾Ñ‚Ñƒ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Telegram ÐºÐ°Ð½Ð°Ð» (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, `@channel` Ð¸Ð»Ð¸ `https://t.me/channel`)
2. **Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸**: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ `/location` Ð¸Ð»Ð¸ ÐºÐ½Ð¾Ð¿ÐºÑƒ "ðŸ“ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð»Ð¾ÐºÐ°Ñ†Ð¸ÑŽ"
3. **ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹**: ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ, Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€:
   - "ÐºÐ¾Ð½Ñ†ÐµÑ€Ñ‚ Ð² ÐœÐ¾ÑÐºÐ²Ðµ"
   - "Ð²Ñ‹ÑÑ‚Ð°Ð²ÐºÐ° Ñ€ÑÐ´Ð¾Ð¼ ÑÐ¾ Ð¼Ð½Ð¾Ð¹"
   - "Ñ„ÐµÑÑ‚Ð¸Ð²Ð°Ð»ÑŒ Ð² Ð¡Ð°Ð½ÐºÑ‚-ÐŸÐµÑ‚ÐµÑ€Ð±ÑƒÑ€Ð³Ðµ"

Ð‘Ð¾Ñ‚ Ð½Ð°Ð¹Ð´ÐµÑ‚ Ñ€ÐµÐ»ÐµÐ²Ð°Ð½Ñ‚Ð½Ñ‹Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¸ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ðµ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð²Ð°ÑˆÐµÐ¹ Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¸.

## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

```
Journey_agent/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bot/              # Telegram Ð±Ð¾Ñ‚
â”‚   â”œâ”€â”€ parsers/          # ÐŸÐ°Ñ€ÑÐµÑ€Ñ‹ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹
â”‚   â”œâ”€â”€ services/         # Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°
â”‚   â”œâ”€â”€ storage/          # Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð‘Ð”
â”‚   â”œâ”€â”€ models/           # ÐœÐ¾Ð´ÐµÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
â”‚   â””â”€â”€ config.py         # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â”œâ”€â”€ scripts/              # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð·Ð°Ð¿ÑƒÑÐºÐ°
â”œâ”€â”€ docker-compose.yml    # Weaviate
â””â”€â”€ requirements.txt      # Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸
```

## Ð Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð°Ñ€ÑÐµÑ€Ð°

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ ÐºÐ»Ð°ÑÑ, Ð½Ð°ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ÑÑ Ð¾Ñ‚ `BaseParser` Ð² `src/parsers/websites/`
2. Ð ÐµÐ°Ð»Ð¸Ð·ÑƒÐ¹Ñ‚Ðµ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ `can_parse()` Ð¸ `parse()`
3. Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¿Ð°Ñ€ÑÐµÑ€ Ð² Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ñ‰Ð¸ÐºÐµ

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹

1. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿Ð°Ñ€ÑÐµÑ€ Ð´Ð»Ñ Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°
2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³ Ð² `SchedulerService`
3. Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð±ÑƒÐ´ÑƒÑ‚ Ð²ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ Ð¸ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒÑÑ Ð² Weaviate

## Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

MIT