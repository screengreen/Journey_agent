# ü§ñ Telegram Bot

Telegram –±–æ—Ç –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π Journey Agent.

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ (`/start`) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –¥–≤–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

| –ö–Ω–æ–ø–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| üó∫Ô∏è **–°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç** | –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö |
| ‚ûï **–î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª** | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Telegram-–∫–∞–Ω–∞–ª–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π |

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∞

1. **–í–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–≤–æ–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è:
   - *"–•–æ—á—É –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –ú–æ—Å–∫–≤—ã, –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Å—å –≤—ã—Å—Ç–∞–≤–∫–∞–º–∏ –∏ –∫–æ–Ω—Ü–µ—Ä—Ç–∞–º–∏"*
   - *"–ü–ª–∞–Ω–∏—Ä—É–π –¥–µ–Ω—å —Å 10:00 –¥–æ 20:00, –±—é–¥–∂–µ—Ç 5000 —Ä—É–±–ª–µ–π"*
   
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞**:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ–∫—Å–∏—á–Ω–æ—Å—Ç—å (Input Guardrails)
   - –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π (Self-RAG)
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–≤—Ä–µ–º—è, –±—é–¥–∂–µ—Ç, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç)
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ (Planning Graph)
   
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–ª–∞–Ω —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏

4. **–£—Ç–æ—á–Ω–µ–Ω–∏–µ**: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- –ü–æ–ª–Ω–∞—è —Å—Å—ã–ª–∫–∞: `https://t.me/channel_name`
- Username: `@channel_name`
- –ü—Ä–æ—Å—Ç–æ –∏–º—è: `channel_name`

### –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞

| –£—Ä–æ–≤–µ–Ω—å | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| **Allow** | –ö–æ–Ω—Ç–µ–Ω—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω |
| **Soft** | –ì—Ä—É–±–æ—Å—Ç—å ‚Äî —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è |
| **Block** | –¢–æ–∫—Å–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç ‚Äî –æ—Ç–∫–∞–∑ |

## üöÄ –ó–∞–ø—É—Å–∫

### Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
docker-compose up -d bot
```

### –õ–æ–∫–∞–ª—å–Ω–æ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–π—Ç–µ .env —Å TELEGRAM_BOT_TOKEN
python -m src.tgbot.bot
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|----------|
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather |
| `WEAVIATE_URL` | URL Weaviate (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: http://localhost:8080) |
| `OPENAI_API_KEY` | API –∫–ª—é—á OpenAI |

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
tgbot/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ bot.py          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –±–æ—Ç–∞ (aiogram + FSM)
‚îú‚îÄ‚îÄ database.py     # SQLite –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–Ω–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îú‚îÄ‚îÄ agent_stub.py   # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å main_pipeline
‚îî‚îÄ‚îÄ README.md
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **aiogram** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è Telegram Bot API
- **FSM (Finite State Machine)** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –¥–∏–∞–ª–æ–≥–∞
- **SQLite** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üìä –°–æ—Å—Ç–æ—è–Ω–∏—è FSM

```
START ‚Üí ADDING_CHANNEL (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞)
     ‚Üò ROUTE_CREATION (–≤–≤–æ–¥ –∑–∞–ø—Ä–æ—Å–∞)
                   ‚Üì
          ROUTE_COMMENT (—É—Ç–æ—á–Ω–µ–Ω–∏–µ –ø–ª–∞–Ω–∞)
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `moderate_text()`:
- LLM-–º–æ–¥–µ—Ä–∞—Ü–∏—è –¥–ª—è —Ç–æ—á–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Heuristic fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ LLM
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É–≥—Ä–æ–∑, –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π, —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
