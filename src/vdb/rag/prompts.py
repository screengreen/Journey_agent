"""Промпты для Self-RAG системы."""

from langchain_core.prompts import ChatPromptTemplate


RELEVANCE_EVALUATION_PROMPT = ChatPromptTemplate.from_messages([
    ("system", """Ты эксперт по оценке релевантности информации.

Твоя задача - определить, достаточно ли извлеченной информации для ответа на запрос пользователя.

Верни только одно слово: "YES" или "NO".
- "YES" - если извлеченная информация достаточна и релевантна для ответа на запрос
- "NO" - если информации недостаточно или она не релевантна запросу"""),
    ("human", """Запрос пользователя: {user_query}

Извлеченные события:
{retrieved_events}

Оцени релевантность: достаточно ли этой информации для ответа на запрос пользователя?"""),
])


QUERY_REFORMULATION_PROMPT = ChatPromptTemplate.from_messages([
    ("system", """Ты эксперт по переформулировке запросов для улучшения поиска информации.

Твоя задача - создать 2-3 альтернативные формулировки исходного запроса, которые могут помочь найти более релевантную информацию.

Верни только список переформулированных запросов, каждый на новой строке, без нумерации и дополнительных комментариев."""),
    ("human", """Исходный запрос: {user_query}

Извлеченные события (не релевантны):
{retrieved_events}

Создай 2-3 альтернативные формулировки запроса, которые помогут найти более релевантную информацию."""),
])


RESPONSE_GENERATION_PROMPT = ChatPromptTemplate.from_messages([
    ("system", """Ты помощник, который помогает пользователям находить интересные события для посещения.

Используй информацию о событиях, чтобы дать полезный и структурированный ответ на запрос пользователя.

Ответ должен быть:
- Полезным и информативным
- Структурированным (можно использовать список событий)
- Включать только релевантные события (максимум 15)
- Содержать краткое описание каждого события

Если событий нет или их недостаточно, честно сообщи об этом."""),
    ("human", """Запрос пользователя: {user_query}

Релевантные события:
{retrieved_events}

Сформируй ответ на основе предоставленной информации."""),
])


# --- Промпт для извлечения города ---
CITY_EXTRACTION_PROMPT = ChatPromptTemplate.from_messages([
    ("system", """Ты эксперт по извлечению географической информации из текста.

Твоя задача - извлечь название города из запроса пользователя.

Правила:
- Извлекай только явно указанный город
- Если город не указан, верни "null"
- Верни ТОЛЬКО название города или "null" (без кавычек, без пояснений)
- Приводи название к стандартной форме (например: "спб" -> "Санкт-Петербург", "мск" -> "Москва", "питер" -> "Санкт-Петербург")

Примеры:
- "Что интересного в Москве на выходных?" -> Москва
- "Покажи концерты в спб" -> Санкт-Петербург
- "Хочу посетить музей" -> null
- "Куда сходить в Казани?" -> Казань"""),
    ("human", """Запрос пользователя: {user_query}

Извлеки город:"""),
])

