# VDB API

FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Weaviate –∏ Self-RAG —Å–∏—Å—Ç–µ–º–æ–π.

## –ó–∞–ø—É—Å–∫

### –° –ø–æ–º–æ—â—å—é Docker Compose

```bash
docker-compose up vdb
```

–≠—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Weaviate –∏ Contextionary).

API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8001`

### –õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
uvicorn src.vdb.api:app --reload --host 0.0.0.0 --port 8001
```

## API Endpoints

### Health Check

#### GET `/`
–ö–æ—Ä–Ω–µ–≤–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8001/
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "service": "Journey Agent VDB API",
  "status": "running",
  "version": "1.0.0",
  "description": "API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö Weaviate –∏ Self-RAG —Å–∏—Å—Ç–µ–º–æ–π"
}
```

#### GET `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Weaviate.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:8001/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "weaviate_connected": true
}
```

### –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π

#### POST `/search`
–ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π —Å –ø–æ–º–æ—â—å—é Self-RAG —Å–∏—Å—Ç–µ–º—ã.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "query": "–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ú–æ—Å–∫–≤–µ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ",
  "owner": "username",  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  "return_logs": false  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤–µ—Ä–Ω—É—Ç—å –ª–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8001/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ú–æ—Å–∫–≤–µ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ",
    "return_logs": true
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "events": [
    {
      "title": "–ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è",
      "description": "–û–ø–∏—Å–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è",
      "owner": "all",
      "location": "–ú–æ—Å–∫–≤–∞, –∞–¥—Ä–µ—Å",
      "country": "–†–æ—Å—Å–∏—è",
      "date": "2024-12-25 10:00",
      "url": "https://example.com/event",
      "source": "telegram_channel",
      "tags": ["–∫–æ–Ω—Ü–µ—Ä—Ç", "–º—É–∑—ã–∫–∞"]
    }
  ],
  "user_prompt": "–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ú–æ—Å–∫–≤–µ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ",
  "constraints": {
    "start_time": null,
    "end_time": null,
    "max_total_time_minutes": null,
    "preferred_transport": null,
    "budget": null,
    "other_constraints": []
  },
  "logs": [
    "üîç –ü–∞—Ä—Å–∏–Ω–≥ —Ñ–∏–ª—å—Ç—Ä–æ–≤: –≥–æ—Ä–æ–¥=–ú–æ—Å–∫–≤–∞, –¥–∞—Ç–∞=–Ω–µ —É–∫–∞–∑–∞–Ω–∞",
    "üîé –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π: –∑–∞–ø—Ä–æ—Å='–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –≤ –ú–æ—Å–∫–≤–µ –Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ', –Ω–∞–π–¥–µ–Ω–æ=5"
  ]
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏

#### POST `/memory/check`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø–∞–º—è—Ç–∏ –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "query": "–ß—Ç–æ —è –∏—Å–∫–∞–ª –ø—Ä–æ –∫–æ–Ω—Ü–µ—Ä—Ç—ã?",
  "owner": "username"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST http://localhost:8001/memory/check \
  -H "Content-Type: application/json" \
  -d '{
    "query": "–ß—Ç–æ —è –∏—Å–∫–∞–ª –ø—Ä–æ –∫–æ–Ω—Ü–µ—Ä—Ç—ã?",
    "owner": "username"
  }'
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "has_memory": true,
  "query": "–ß—Ç–æ —è –∏—Å–∫–∞–ª –ø—Ä–æ –∫–æ–Ω—Ü–µ—Ä—Ç—ã?",
  "owner": "username"
}
```

## –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

- Swagger UI: http://localhost:8001/docs
- ReDoc: http://localhost:8001/redoc

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python

```python
import requests

# –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π
response = requests.post(
    "http://localhost:8001/search",
    json={
        "query": "–ù–∞–π–¥–∏ –∫–æ–Ω—Ü–µ—Ä—Ç—ã –¥–∂–∞–∑–æ–≤–æ–π –º—É–∑—ã–∫–∏ –≤ –ú–æ—Å–∫–≤–µ",
        "return_logs": True
    }
)
data = response.json()
print(f"–ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: {len(data['events'])}")
for event in data['events']:
    print(f"- {event['title']} ({event['location']})")
```

### JavaScript/Node.js

```javascript
const fetch = require('node-fetch');

// –ü–æ–∏—Å–∫ —Å–æ–±—ã—Ç–∏–π
const response = await fetch('http://localhost:8001/search', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    query: '–ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –≤—ã—Å—Ç–∞–≤–∫–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ',
    return_logs: false
  })
});

const data = await response.json();
console.log(`–ù–∞–π–¥–µ–Ω–æ —Å–æ–±—ã—Ç–∏–π: ${data.events.length}`);
data.events.forEach(event => {
  console.log(`- ${event.title} (${event.location})`);
});
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤ `.env` –∏–ª–∏ —á–µ—Ä–µ–∑ docker-compose):

- `WEAVIATE_URL` - URL —Å–µ—Ä–≤–µ—Ä–∞ Weaviate (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `http://weaviate:8080`)
- `COLLECTION_NAME` - –ò–º—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `Events`)
- `OPENAI_API_KEY` - **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**: API –∫–ª—é—á OpenAI (–Ω—É–∂–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–π: OpenAI –∏–ª–∏ Mistral)
- `OPENAI_MODEL` - –ú–æ–¥–µ–ª—å OpenAI (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `gpt-4o-mini`)
- `MISTRAL_API_KEY` - API –∫–ª—é—á Mistral (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –Ω—É–∂–µ–Ω —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–π: OpenAI –∏–ª–∏ Mistral)
- `MISTRAL_MODEL` - –ú–æ–¥–µ–ª—å Mistral (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `mistral-small-latest`)

**–í–∞–∂–Ω–æ**: 
- –î–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ API –∫–ª—é—á–µ–π (`OPENAI_API_KEY` –∏–ª–∏ `MISTRAL_API_KEY`) –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OPENAI_API_KEY`**, —Ç–∞–∫ –∫–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Mistral –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` —Ñ–∞–π–ª–∞ –∏–ª–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Ö–æ—Å—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–ü—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞:
```bash
# –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI
OPENAI_API_KEY=sk-...

# –ò–ª–∏ Mistral (—Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ langchain-mistralai, –º–æ–∂–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å)
MISTRAL_API_KEY=...
```

